# Derived from ./manifests/*.yaml
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: grafana-core
  namespace: sky-firmament
  labels:
    app: grafana
    component: core
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: grafana
        component: core
    spec:
      containers:
        - image: {{ grafana_image }}
          name: grafana-core
          # env:
          resources:
            # keep request = limit to keep this container in guaranteed class
            limits:
              cpu: 100m
              memory: 100Mi
            requests:
              cpu: 100m
              memory: 100Mi
          ports:
            - name: grafana
              containerPort: 3000
          env:
            # This variable is required to setup templates in Grafana.
              # The following env variables are required to make Grafana accessible via
              # the kubernetes api-server proxy. On production clusters, we recommend
              # removing these env variables, setup auth for grafana, and expose the grafana
              # service using a LoadBalancer or a public IP.
            - name: GF_AUTH_BASIC_ENABLED
              value: "true"
            - name: GF_AUTH_ANONYMOUS_ENABLED
              value: "true"
            - name: GF_AUTH_ANONYMOUS_ORG_ROLE
              value: Admin
            # - name: GF_SERVER_ROOT_URL
            #   value: /api/v1/proxy/namespaces/monitoring/services/grafana/
          volumeMounts:
          - name: grafana-persistent-storage
            mountPath: /var/lib/grafana/data
      volumes:
      - name: grafana-persistent-storage
        hostPath:
          path: /grafanaData
      nodeSelector:
        prometheus: "yes"
---
apiVersion: v1
kind: Service
metadata:
  name: grafana
  namespace: sky-firmament
  labels:
    app: grafana
    component: core
  #  annotations:
  #   prometheus.io/scrape: 'true'
spec:
  type: NodePort
  ports:
    - port: 3000
      nodePort: {{ grafana_nodeport }}
  selector:
    app: grafana
    component: core
---
# based on the content created by:
# kubectl create configmap grafana-import-dashboards --from-file=manifests/grafana-import-dashboards-configmap --output yaml

apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-import-dashboards
  namespace: sky-firmament
  labels:
    app: grafana
    component: import-dashboards
data:
{% raw %}
  grafana-cluster-metrics-dashboard.json: |
    {"dashboard":{"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"4.1.2"},{"type":"panel","id":"grafana-piechart-panel","name":"Pie Chart","version":"1.1.4"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"},{"type":"panel","id":"singlestat","name":"Singlestat","version":""}],"annotations":{"list":[]},"editable":false,"gnetId":null,"graphTooltip":1,"hideControls":true,"id":null,"links":[],"refresh":"5s","rows":[{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","decimals":2,"editable":true,"error":false,"fill":1,"grid":{},"id":1,"legend":{"alignAsTable":false,"avg":false,"current":false,"hideEmpty":true,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"cluster_cpu_usage_ratio","intervalFactor":2,"legendFormat":"使用率","metric":"cluster_cpu_usage_ratio","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU使用率","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percent","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":2,"legend":{"avg":false,"current":false,"hideEmpty":true,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"cluster_memory_usage_ratio","intervalFactor":2,"legendFormat":"使用率","metric":"cluster_memory_usage_ratio","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"内存使用率","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percent","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Row","titleSize":"h6"},{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":3,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"cluster_network_receive_bps","intervalFactor":2,"legendFormat":"  接收","metric":"cluster_network_receive_bps","refId":"A","step":2},{"expr":"cluster_network_transmit_bps","intervalFactor":2,"legendFormat":"  发送","metric":"cluster_network_transmit_bps","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"网络IO","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"cluster_disk_read_bps","intervalFactor":2,"legendFormat":"读取","metric":"cluster_disk_read_bps","refId":"A","step":2},{"expr":"cluster_disk_written_bps","intervalFactor":2,"legendFormat":"写入","metric":"cluster_disk_written_bps","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"磁盘IO","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"New row","titleSize":"h6"},{"collapse":false,"height":187,"panels":[{"aliasColors":{},"cacheTimeout":null,"combine":{"label":"Others","threshold":0},"datasource":"prometheus","fontSize":"100%","format":"none","height":"","id":5,"interval":null,"legend":{"percentage":false,"show":false,"values":false},"legendType":"On graph","links":[],"maxDataPoints":3,"nullPointMode":"connected","pieType":"donut","span":4,"strokeWidth":"1.0","targets":[{"expr":"cluster_cpu_cores_total*cluster_cpu_usage_ratio/100","hide":false,"interval":"","intervalFactor":2,"legendFormat":"已使用","metric":"cluster_cpu_usage_ratio","refId":"A","step":240},{"expr":"cluster_cpu_cores_total-cluster_cpu_cores_total*cluster_cpu_usage_ratio/100","hide":false,"interval":"","intervalFactor":2,"legendFormat":"未使用","metric":"cluster_cpu_usage_ratio","refId":"B","step":240}],"title":"CPU","type":"grafana-piechart-panel","valueName":"current"},{"aliasColors":{},"cacheTimeout":null,"combine":{"label":"Others","threshold":"0"},"datasource":"prometheus","fontSize":"100%","format":"bytes","id":6,"interval":null,"legend":{"percentage":true,"show":false,"values":true},"legendType":"On graph","links":[],"maxDataPoints":3,"nullPointMode":"connected","pieType":"donut","span":4,"strokeWidth":"1","targets":[{"expr":"cluster_memory_used_bytes","intervalFactor":2,"legendFormat":"已使用","metric":"cluster_memory_total_bytes","refId":"A","step":240},{"expr":"cluster_memory_total_bytes-cluster_memory_used_bytes","intervalFactor":2,"legendFormat":"未使用","refId":"B","step":240}],"title":"内存","type":"grafana-piechart-panel","valueName":"current"},{"aliasColors":{},"cacheTimeout":null,"combine":{"label":"Others","threshold":0},"datasource":"prometheus","fontSize":"100%","format":"bytes","id":7,"interval":null,"legend":{"percentage":false,"show":false,"values":true},"legendType":"On graph","links":[],"maxDataPoints":3,"nullPointMode":"connected","pieType":"donut","span":4,"strokeWidth":1,"targets":[{"expr":"cluster_filesystem_used_total","intervalFactor":2,"legendFormat":"已使用","refId":"A","step":240},{"expr":"cluster_filesystem_size_total-cluster_filesystem_used_total","intervalFactor":2,"legendFormat":"未使用","refId":"B","step":240}],"title":"磁盘","transparent":false,"type":"grafana-piechart-panel","valueName":"current"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":42,"panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus","decimals":2,"format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":8,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"   cores","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"targets":[{"expr":"cluster_cpu_usage_ratio*cluster_cpu_cores_total/100.0","intervalFactor":2,"legendFormat":"","metric":"cluster_cpu_cores_total","refId":"A","step":4}],"thresholds":"","timeFrom":null,"timeShift":null,"title":"已使用","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus","decimals":2,"format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":9,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":" cores","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"targets":[{"expr":"cluster_cpu_cores_total","intervalFactor":2,"legendFormat":"","metric":"cluster_cpu_cores_total","refId":"A","step":4}],"thresholds":"","title":"总量","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus","decimals":2,"format":"bytes","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":10,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"targets":[{"expr":"cluster_memory_used_bytes","intervalFactor":2,"metric":"cluster_memory_usage_bytes","refId":"A","step":4}],"thresholds":"","title":"已使用","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus","decimals":2,"format":"bytes","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":11,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"targets":[{"expr":"cluster_memory_total_bytes","intervalFactor":2,"metric":"cluster_memory_total_bytes","refId":"A","step":4}],"thresholds":"","title":"总量","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus","decimals":2,"format":"bytes","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":12,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"targets":[{"expr":"cluster_filesystem_used_total","hide":false,"intervalFactor":2,"metric":"cluster_filesystem_free_total","refId":"A","step":4}],"thresholds":"","title":"已使用","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus","decimals":2,"format":"bytes","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":13,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":2,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"targets":[{"expr":"cluster_filesystem_size_total","intervalFactor":2,"metric":"cluster_filesystem_size_total","refId":"A","step":4}],"thresholds":"","title":"总量","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h3"}],"schemaVersion":14,"style":"dark","tags":[],"templating":{"list":[]},"time":{"from":"now-5m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"cluster_metrics","version":43}}
  grafana-node-metrics-dashboard.json: |
    {"dashboard":{"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"4.1.2"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"}],"annotations":{"list":[]},"editable":false,"gnetId":null,"graphTooltip":1,"hideControls":true,"id":null,"links":[],"refresh":"5s","rows":[{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":1,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"connected","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"node_cpu_usage_ratio{kubernetes_io_hostname=\"$nodeName\"}","intervalFactor":2,"legendFormat":"使用率","metric":"node_cpu_usage_ratio","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU使用率","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percent","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":2,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"node_memory_usage_ratio{kubernetes_io_hostname=\"$nodeName\"}","intervalFactor":2,"legendFormat":"使用率","metric":"node_memory_usage_ratio","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"内存使用率","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percent","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Row","titleSize":"h6"},{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":3,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"node_network_receive_bps{kubernetes_io_hostname=\"$nodeName\"}","intervalFactor":2,"legendFormat":"接收","metric":"node_network_receive_bps","refId":"A","step":2},{"expr":"node_network_transmit_bps{kubernetes_io_hostname=\"$nodeName\"}","intervalFactor":2,"legendFormat":"发送","metric":"node_network_transmit_bps","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"网络IO","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"node_disk_read_bps{kubernetes_io_hostname=\"$nodeName\"}","intervalFactor":2,"legendFormat":"读取","metric":"node_disk_read_bps","refId":"A","step":2},{"expr":"node_disk_written_bps{kubernetes_io_hostname=\"$nodeName\"}","intervalFactor":2,"legendFormat":"写入","metric":"node_disk_written_bps","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"磁盘IO","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"New row","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":[],"templating":{"list":[{"allValue":".*","current":{},"datasource":"prometheus","hide":0,"includeAll":false,"label":null,"multi":false,"name":"nodeName","options":[],"query":"label_values(kubernetes_io_hostname)","refresh":1,"regex":"","sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-5m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"node_metrics","version":17}}
  grafana-pod-metrics-dashboard.json: |
    {"dashboard":{"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"4.1.2"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"}],"annotations":{"list":[]},"editable":false,"gnetId":null,"graphTooltip":1,"hideControls":true,"id":null,"links":[],"refresh":"10s","rows":[{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":1,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"pod_cpu_cores_used{namespace=\"$namespaceName\",pod_name=\"$podName\"}","intervalFactor":2,"legendFormat":"核数","metric":"pod_cpu_usage_ratio","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU使用核数","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percent","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":2,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"pod_memory_usage_bytes{namespace=\"$namespaceName\",pod_name=\"$podName\"}","intervalFactor":2,"legendFormat":"使用量","metric":"pod_memory_usage_bytes","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"内存使用量","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Row","titleSize":"h6"},{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":3,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"pod_network_receive_bps{namespace=\"$namespaceName\",pod_name=\"$podName\"}","intervalFactor":2,"legendFormat":"接收","metric":"pod_network_receive_bps","refId":"A","step":2},{"expr":"pod_network_transmit_bps{namespace=\"$namespaceName\",pod_name=\"$podName\"}","intervalFactor":2,"legendFormat":"发送","metric":"pod_network_transmit_bps","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"网络IO","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","decimals":2,"editable":true,"error":false,"fill":1,"grid":{},"id":4,"legend":{"avg":false,"current":false,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"pod_fs_usage_bytes{namespace=\"$namespaceName\",pod_name=\"$podName\"}","intervalFactor":2,"legendFormat":"使用量","metric":"pod_fs_usage_bytes","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"磁盘使用量","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"New row","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{},"datasource":"prometheus","hide":0,"includeAll":false,"label":"","multi":false,"name":"namespaceName","options":[],"query":"label_values(container_cpu_system_seconds_total{image!=\"\",namespace!=\"\"},namespace)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"prometheus","hide":0,"includeAll":false,"label":"","multi":false,"name":"podName","options":[],"query":"label_values(container_cpu_system_seconds_total{image!=\"\",namespace=\"$namespaceName\"},pod_name)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-5m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"pod_metrics","version":7}}
  grafana-container-metrics-dashboard.json: |
    {"dashboard":{"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"4.1.2"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"}],"annotations":{"list":[]},"editable":false,"gnetId":null,"graphTooltip":1,"hideControls":true,"id":null,"links":[],"refresh":"10s","rows":[{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":1,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"container_cpu_cores_used{namespace=\"$namespaceName\",pod_name=\"$podName\",container_name=\"$containerName\"}","intervalFactor":2,"legendFormat":"核数","metric":"container_cpu_usage_ratio","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU使用核数","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"none","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":2,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"container_memory_usage_bytes{namespace=\"$namespaceName\",pod_name=\"$podName\",container_name=\"$containerName\"}","intervalFactor":2,"legendFormat":"使用量","metric":"container_memory_usage_bytes","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"内存使用量","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Row","titleSize":"h6"},{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":3,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_network_receive_bps{namespace=\"$namespaceName\",pod_name=\"$podName\",container_name=\"POD\"})","intervalFactor":2,"legendFormat":"接收","metric":"container_network_receive_bps","refId":"A","step":2},{"expr":"sum(container_network_transmit_bps{namespace=\"$namespaceName\",pod_name=\"$podName\",container_name=\"POD\"})","intervalFactor":2,"legendFormat":"发送","metric":"container_network_transmit_bps","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"网络IO","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","decimals":2,"editable":true,"error":false,"fill":1,"grid":{},"id":4,"legend":{"avg":false,"current":false,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"container_fs_usage_bytes{namespace=\"$namespaceName\",pod_name=\"$podName\",container_name=\"$containerName\"}","intervalFactor":2,"legendFormat":"使用量","metric":"container_fs_usage_bytes","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"磁盘使用量","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"New row","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{},"datasource":"prometheus","hide":0,"includeAll":false,"label":"","multi":false,"name":"namespaceName","options":[],"query":"label_values(container_cpu_system_seconds_total{image!=\"\",namespace!=\"\"},namespace)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"prometheus","hide":0,"includeAll":false,"label":"","multi":false,"name":"podName","options":[],"query":"label_values(container_cpu_system_seconds_total{image!=\"\",namespace=\"$namespaceName\"},pod_name)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"prometheus","hide":0,"includeAll":false,"label":"","multi":false,"name":"containerName","options":[],"query":"label_values(container_cpu_system_seconds_total{image!=\"\",namespace=\"$namespaceName\",pod_name=\"$podName\"},container_name)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-5m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"container_metrics","version":7}}
  grafana-service-metrics-dashboard.json: |
    {"dashboard":{"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"4.1.2"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"}],"annotations":{"list":[]},"editable":false,"gnetId":null,"graphTooltip":0,"hideControls":true,"id":null,"links":[],"refresh":"5s","rows":[{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":1,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_cpu_cores_used{namespace=\"$namespaceName\",pod_name=~\"^$serviceName-.*$\"})","intervalFactor":2,"legendFormat":"核数","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU使用核数","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percent","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":2,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_memory_usage_bytes{namespace=\"$namespaceName\",pod_name=~\"^$serviceName-.*$\"})","intervalFactor":2,"legendFormat":"使用量","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"内存使用量","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Row","titleSize":"h6"},{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":3,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_network_transmit_bps{namespace=\"$namespaceName\",pod_name=~\"^$serviceName-.*$\"})","intervalFactor":2,"legendFormat":"发送","refId":"A","step":2},{"expr":"sum(container_network_receive_bps{namespace=\"$namespaceName\",pod_name=~\"^$serviceName-.*$\"})","intervalFactor":2,"legendFormat":"接收","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"网络IO","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_fs_usage_bytes{namespace=\"$namespaceName\",pod_name=~\"^$serviceName-.*$\"})","intervalFactor":2,"legendFormat":"使用量","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"磁盘使用量","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"New row","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{},"datasource":"prometheus","hide":0,"includeAll":false,"label":"","multi":false,"name":"namespaceName","options":[],"query":"label_values(namespace)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"prometheus","hide":0,"includeAll":false,"label":"","multi":false,"name":"serviceName","options":[],"query":"label_values(k8s_pod_labels{app!=\"\", namespace=\"$namespaceName\"},app)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-5m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"service_metrics","version":7}}
  grafana-deployment-metrics-dashboard.json: |
    {"dashboard":{"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"4.1.2"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"}],"annotations":{"list":[]},"editable":false,"gnetId":null,"graphTooltip":0,"hideControls":true,"id":null,"links":[],"refresh":"5s","rows":[{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":1,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_cpu_cores_used {namespace=\"$namespaceName\",pod_name=~\"^$serviceName-([0-9]{10}-){0,1}[a-zA-Z0-9]{5}$\"})","intervalFactor":2,"legendFormat":"核数","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU使用核数","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"none","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":2,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_memory_usage_bytes{namespace=\"$namespaceName\",pod_name=~\"^$serviceName-([0-9]{10}-){0,1}[a-zA-Z0-9]{5}$\"})","intervalFactor":2,"legendFormat":"使用量","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"内存使用量","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Row","titleSize":"h6"},{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":3,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_network_transmit_bps{namespace=\"$namespaceName\",pod_name=~\"^$serviceName-([0-9]{10}-){0,1}[a-zA-Z0-9]{5}$\"})","intervalFactor":2,"legendFormat":"发送","refId":"A","step":2},{"expr":"sum(container_network_receive_bps{namespace=\"$namespaceName\",pod_name=~\"^$serviceName-([0-9]{10}-){0,1}[a-zA-Z0-9]{5}$\"})","intervalFactor":2,"legendFormat":"接收","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"网络IO","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","editable":true,"error":false,"fill":1,"grid":{},"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":1,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(container_fs_usage_bytes{namespace=\"$namespaceName\",pod_name=~\"^$serviceName-([0-9]{10}-){0,1}[a-zA-Z0-9]{5}$\"})","intervalFactor":2,"legendFormat":"使用量","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"磁盘使用量","tooltip":{"msResolution":true,"shared":true,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"New row","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{"text":"sky-firmament","value":"sky-firmament"},"datasource":null,"hide":0,"includeAll":false,"label":"","multi":false,"name":"namespaceName","options":[{"selected":true,"text":"sky-firmament","value":"sky-firmament"}],"query":"sky-firmament","refresh":0,"type":"custom"},{"allValue":null,"current":{"text":"prometheus-core","value":"prometheus-core"},"datasource":null,"hide":0,"includeAll":false,"label":"","multi":false,"name":"serviceName","options":[{"selected":true,"text":"prometheus-core","value":"prometheus-core"}],"query":"prometheus-core","refresh":0,"type":"custom"}]},"time":{"from":"now-5m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"deployment_metrics","version":19}}
  grafana-ecp-mysql-metrics-dashboard.json: |
    {"dashboard":{"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"4.1.2"},{"type":"panel","id":"grafana-piechart-panel","name":"Pie Chart","version":"1.1.4"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"},{"type":"panel","id":"singlestat","name":"Singlestat","version":""}],"annotations":{"list":[]},"editable":true,"gnetId":null,"graphTooltip":0,"hideControls":false,"id":null,"links":[],"refresh":"10s","rows":[{"collapse":false,"height":"250px","panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus","decimals":2,"format":"s","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":1,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":4,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"targets":[{"expr":"mysql_global_status_uptime{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"","metric":"mysql_up","refId":"A","step":4}],"thresholds":"","title":"服务启动时间","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"aliasColors":{},"cacheTimeout":null,"combine":{"label":"Others","threshold":0},"datasource":"prometheus","fontSize":"50%","format":"short","id":2,"interval":null,"legend":{"show":true,"values":true},"legendType":"On graph","links":[],"maxDataPoints":3,"nullPointMode":"connected","pieType":"pie","span":4,"strokeWidth":1,"targets":[{"expr":"mysql_global_status_connections{release=\"$releaseName\"}-mysql_global_status_aborted_connects{release=\"$releaseName\"}-mysql_global_status_aborted_clients{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"正常连接","refId":"A","step":240},{"expr":"mysql_global_status_aborted_connects{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"失败连接","refId":"B","step":240},{"expr":"mysql_global_status_aborted_clients{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"中断连接","refId":"C","step":240}],"title":"连接状态","type":"grafana-piechart-panel","valueName":"current"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus","format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":3,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":4,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":true},"targets":[{"expr":"mysql_global_status_max_used_connections{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"","refId":"A","step":4}],"thresholds":"","title":"并发连接数","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","fill":1,"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"irate(mysql_global_status_bytes_sent{release=\"$releaseName\"}[1m])","intervalFactor":2,"legendFormat":"{{$releaseName}} ---> clients","refId":"A","step":2},{"expr":"irate(mysql_global_status_bytes_received{release=\"$releaseName\"}[1m])","intervalFactor":2,"legendFormat":"clients ---> {{$releaseName}} ","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"服务IO","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","decimals":2,"fill":1,"id":5,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":false,"min":false,"rightSide":true,"show":false,"sort":"current","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"count  (mysql_global_status_commands_total{release=\"$releaseName\"}) by (command)","intervalFactor":2,"legendFormat":"{{command}}","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Commands","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"transparent":false,"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":["total"]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{},"datasource":"prometheus","hide":0,"includeAll":false,"label":null,"multi":false,"name":"releaseName","options":[],"query":"label_values(mysql_exporter_last_scrape_duration_seconds{chart=\"mysql-0.2.3\"},release)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-5m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"ecp_mysql_metrics","version":15}}
  grafana-ecp-app-common-metrics-dashboard.json: |
    {"dashboard":{"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"4.1.2"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"}],"annotations":{"list":[]},"editable":true,"gnetId":null,"graphTooltip":0,"hideControls":false,"id":null,"links":[],"refresh":"5s","rows":[{"collapse":false,"height":"250px","panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","fill":1,"id":1,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"release_cpu_used_cores{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"核数","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU使用核数","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","fill":1,"id":2,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"release_memory_used_bytes{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"使用量","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"内存使用量","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","fill":1,"id":3,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"release_network_receive_bps{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"接收","metric":"release_network_receive_bps","refId":"A","step":2},{"expr":"release_network_transmit_bps{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"发送","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"网络IO","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","fill":1,"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"release_fs_usage_bytes{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"使用量","metric":"release_fs_usage_bytes","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"磁盘使用量","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","fill":1,"id":5,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"release_pod_cpu_used_cores{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"{{pod_name}}","metric":"release_pod_cpu_used_cores","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU使用核数(By POD)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","fill":1,"id":6,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"release_pod_memory_used_bytes{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"{{pod_name}}","metric":"release_pod_memory_used_bytes","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"内存使用量(By POD)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","fill":1,"id":7,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"release_pod_network_receive_bps{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"接收-{{pod_name}}","metric":"release_pod_network_receive_bps","refId":"A","step":2},{"expr":"-release_pod_network_transmit_bps{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"发送-{{pod_name}}","metric":"release_pod_network_transmit_bps","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"网络IO(By POD)","tooltip":{"shared":false,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":["total"]},"yaxes":[{"format":"Bps","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":"","logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","fill":1,"id":8,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":6,"stack":false,"steppedLine":false,"targets":[{"expr":"release_pod_fs_usage_bytes{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"{{pod_name}}","metric":"release_pod_fs_usage_bytes","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"磁盘使用量(By POD)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{},"datasource":"prometheus","hide":0,"includeAll":false,"label":null,"multi":false,"name":"releaseName","options":[],"query":"label_values(k8s_pod_labels{release!=\"\"},release)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-5m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"ecp_app_common_metrics","version":28}}
  grafana-ecp-vote-metrics-dashboard.json: |
    {"dashboard":{"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"4.1.2"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"},{"type":"panel","id":"singlestat","name":"Singlestat","version":""}],"annotations":{"list":[]},"editable":true,"gnetId":null,"graphTooltip":0,"hideControls":false,"id":null,"links":[],"refresh":"10s","rows":[{"collapse":false,"height":250,"panels":[{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus","format":"s","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":5,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":6,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false},"targets":[{"expr":"redis_uptime_in_seconds{release=\"$releaseName\"}","intervalFactor":2,"refId":"A","step":4}],"thresholds":"","title":"服务启动时间","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"datasource":"prometheus","format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"id":1,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"span":6,"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":true},"targets":[{"expr":"redis_connected_clients{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"","refId":"A","step":4}],"thresholds":"","title":"redis客户端个数","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"},{"collapse":false,"height":250,"panels":[{"aliasColors":{},"bars":false,"datasource":"prometheus","decimals":2,"fill":1,"id":4,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":3,"stack":false,"steppedLine":false,"targets":[{"expr":"redis_keyspace_hits_total{release=\"$releaseName\"}/(redis_keyspace_hits_total{release=\"$releaseName\"}+redis_keyspace_misses_total{release=\"$releaseName\"})*100","intervalFactor":2,"legendFormat":"命中率","refId":"A","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"命中率","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percent","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","fill":1,"id":3,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":3,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(redis_net_input_bytes_total{release=\"$releaseName\"}[1m])","intervalFactor":2,"legendFormat":"输入","refId":"A","step":2},{"expr":"rate(redis_net_output_bytes_total{release=\"$releaseName\"}[1m])","intervalFactor":2,"legendFormat":"输出","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"服务IO","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"decbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","fill":1,"id":2,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":3,"stack":false,"steppedLine":false,"targets":[{"expr":"redis_memory_used_rss_bytes{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"RSS内存","refId":"A","step":2},{"expr":"redis_memory_used_bytes{release=\"$releaseName\"}","intervalFactor":2,"legendFormat":"服务内存","refId":"B","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"redis内存使用量","tooltip":{"shared":false,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":["total"]},"yaxes":[{"format":"bytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]},{"aliasColors":{},"bars":false,"datasource":"prometheus","decimals":null,"fill":1,"id":6,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"span":3,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(redis_used_cpu_sys{release=\"$releaseName\"}[1m])+rate(redis_used_cpu_sys_children{release=\"$releaseName\"}[1m])","intervalFactor":2,"legendFormat":"system","refId":"A","step":2},{"expr":"rate(redis_used_cpu_user{release=\"$releaseName\"}[1m])+rate(redis_used_cpu_user_children{release=\"$releaseName\"}[1m])","intervalFactor":2,"legendFormat":"user","refId":"B","step":2},{"expr":"rate(redis_used_cpu_sys{release=\"$releaseName\"}[1m])+rate(redis_used_cpu_sys_children{release=\"$releaseName\"}[1m])+rate(redis_used_cpu_user{release=\"$releaseName\"}[1m])+rate(redis_used_cpu_user_children{release=\"$releaseName\"}[1m])","intervalFactor":2,"legendFormat":"total","refId":"C","step":2}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"CPU使用率","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":false,"title":"Dashboard Row","titleSize":"h6"}],"schemaVersion":14,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{},"datasource":"prometheus","hide":0,"includeAll":false,"label":null,"multi":false,"name":"releaseName","options":[],"query":"label_values(redis_up{chart=\"redis-0.1.0\"},release)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-5m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"ecp_vote_metrics","version":21}}
  prometheus-datasource.json: |
    {
      "name": "prometheus",
      "type": "prometheus",
      "url": "http://prometheus:9090",
      "access": "proxy",
      "basicAuth": false
    }
{% endraw %}
---
apiVersion: batch/v1
kind: Job
metadata:
  name: grafana-import-dashboards
  namespace: sky-firmament
  labels:
    app: grafana
    component: import-dashboards
spec:
  template:
    metadata:
      name: grafana-import-dashboards
      labels:
        app: grafana
        component: import-dashboards
    spec:
      containers:
      - name: grafana-import-dashboards
        image: {{ curl_image }}
        command: ["/bin/sh", "-c"]
        workingDir: /opt/grafana-import-dashboards
        args:
          # FIXME use kubernetes probe instead of "until curl"
          - >
            until $(curl --silent --fail --show-error --output /dev/null http://admin:admin@grafana:3000/api/datasources); do
              printf '.' ; sleep 1 ;
            done ;
            for file in *-datasource.json ; do
              if [ -e "$file" ] ; then
                echo "importing $file" &&
                curl --silent --fail --show-error \
                  --request POST http://admin:admin@grafana:3000/api/datasources \
                  --header "Content-Type: application/json" \
                  --data-binary "@$file" ;
                echo "" ;
              fi
            done ;
            for file in *-dashboard.json ; do
              if [ -e "$file" ] ; then
                echo "importing $file" &&
                curl --silent --fail --show-error \
                  --request POST http://admin:admin@grafana:3000/api/dashboards/import \
                  --header "Content-Type: application/json" \
                  --data-binary "@$file" ;
                echo "" ;
              fi
            done

        volumeMounts:
        - name: config-volume
          mountPath: /opt/grafana-import-dashboards
      restartPolicy: Never
      volumes:
      - name: config-volume
        configMap:
          name: grafana-import-dashboards
---
kind: Deployment
apiVersion: extensions/v1beta1
metadata:
  name: kube-state-metrics-deployment
  namespace: kube-system
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: kube-state-metrics
    spec:
      serviceAccountName: kube-state-metrics
      containers:
      - name: kube-state-metrics
        image: {{ kubestatemetrics_image }}
        ports:
        - name: exporter
          containerPort: 8080
        readinessProbe:
          httpGet:
            path: /healthz
            port: 8080
          initialDelaySeconds: 5
          timeoutSeconds: 5
        resources:
          requests:
            cpu: 10m
            memory: 10Mi
          limits:
            cpu: 100m
            memory: 50Mi
---
kind: Service
apiVersion: v1
metadata:
  name: kube-state-metrics
  namespace: kube-system
  annotations:
    prometheus.io/scrape: 'true'
  labels:
    app: kube-state-metrics
spec:
  type: NodePort
  selector:
    app: kube-state-metrics
  ports:
  - name: kube-state-metrics
    port: 8080
    nodePort: {{ kubestatemetrics_nodeport }}
---
apiVersion: v1
kind: Service
metadata:
  name: prometheus
  namespace: sky-firmament
  labels:
    app: prometheus
    component: core
  annotations:
    prometheus.io/scrape: 'true'
spec:
  type: NodePort
  ports:
    - port: 9090
      nodePort: {{ prometheus_nodeport }}
      protocol: TCP
      name: webui
  selector:
    app: prometheus
    component: core
---
apiVersion: extensions/v1beta1
kind: DaemonSet
metadata:
  name: prometheus-node-exporter
  namespace: sky-firmament
  labels:
    app: prometheus
    component: node-exporter
spec:
  template:
    metadata:
      name: prometheus-node-exporter
      labels:
        app: prometheus
        component: node-exporter
    spec:
      containers:
      - image: {{ nodeexporter_image }}
        name: prometheus-node-exporter
        ports:
        - name: prom-node-exp
          #^ must be an IANA_SVC_NAME (at most 15 characters, ..)
          containerPort: 9100
          hostPort: 9100
      hostNetwork: true
      hostPID: true
---
apiVersion: v1
kind: Service
metadata:
  annotations:
    prometheus.io/scrape: 'true'
  name: prometheus-node-exporter
  namespace: sky-firmament
  labels:
    app: prometheus
    component: node-exporter
spec:
  clusterIP: None
  ports:
    - name: prometheus-node-exporter
      port: 9100
      protocol: TCP
  selector:
    app: prometheus
    component: node-exporter
  type: ClusterIP
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: kube-api-exporter
  namespace: kube-system
spec:
  replicas: 1
  template:
    metadata:
      labels:
        name: kube-api-exporter
    spec:
      serviceAccountName: kube-state-metrics
      containers:
      - name: kube-api-exporter
        image: {{ kubeapiexporter_image }}
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: kube-api-exporter
  namespace: kube-system
  annotations:
    prometheus.io/scrape: 'true'
    prometheus.io/path: '/'
spec:
  ports:
    - port: 80
      name: http
  selector:
    name: kube-api-exporter
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: prometheus-core
  namespace: sky-firmament
  labels:
    app: prometheus
    component: core
spec:
  replicas: 1
  selector:
    matchLabels:
      app: prometheus
      component: core
  template:
    metadata:
      name: prometheus-main
      labels:
        app: prometheus
        component: core
    spec:
      serviceAccountName: prometheus
      containers:
      - name: prometheus
        image: {{ prometheus_image }}
        args:
          - '-storage.local.retention=6h'
          - '-storage.local.memory-chunks=500000'
          - '-config.file=/etc/prometheus/prometheus.yml'
          - '-alertmanager.url=http://events-firmament-com:8086/events'
        ports:
        - name: webui
          containerPort: 9090
        volumeMounts:
        - name: config-volume
          mountPath: /etc/prometheus
        - name: data-volume
          mountPath: /prometheus
      volumes:
      - name: config-volume
        hostPath:
          path: /opt/prometheus_config
      - name: data-volume
        hostPath:
          # directory location on host
          path: /prometheusData
      nodeSelector:
        prometheus: "yes"
